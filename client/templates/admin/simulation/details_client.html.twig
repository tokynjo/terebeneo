{% extends 'admin/layout.html.twig' %}
{% block title %}
    {% if(partner) %}
        {{ 'partners.edit_title'|trans({},'label', 'fr') }}
    {% else  %}
        {{ 'partners.create_title'|trans({},'label', 'fr') }}
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .inline-label {min-width:100px; font-weight: 600; }
    </style>

{% endblock %}
{% block body_id 'step1' %}

{% block body %}
    <!-- Breadcrumbs-->

    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ path('admin_simulation_index') }}"><i class="fa fa-fw fa-chevron-right"></i>{{ 'menu.simulations'|trans({},'label', 'fr') }} </a>
        </li>
        {% if(partner.id) %}
            <li class="breadcrumb-item active">{{ 'simulations.client_details'|trans({},'label', 'fr') }}</li>
        {% else  %}
            <li class="breadcrumb-item active">{{ 'simulations.create_client'|trans({},'label', 'fr') }}</li>
        {% endif %}

    </ol>
    <div class="row">
        <div class="col-12">
            <div class="card mb-3">
                <div class="card-header">
                    <h2><i class="fa fa-users"></i>
                        {% if(partner.id) %}
                            {{ 'simulations.client_details'|trans({},'label', 'fr') }}
                        {% else  %}
                            {{ 'simulations.create_title'|trans({},'label', 'fr') }}
                        {% endif %}
                    </h2>
                </div>
                <div class="card-body">
                    {% if app.session.flashBag.has('error') %}
                        <div class="row error-message">
                            <ul>
                                {% for msg in app.session.flashBag.get('error') %}
                                    <li><i class="fa fa-warning"></i> {{ msg }} </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    {{ form_start(form,{'method':'POST', 'attr': {'class': 'form-control no-border'}}) }}
                        {% if not form.vars.valid %}
                            <div class="form-row " >
                                <ul>
                                    {% for child in form.children %}
                                        {%for error in child.vars.errors%}
                                            <li>{{error}}</li>
                                        {%endfor%}
                                    {%endfor%}
                                </ul>
                            </div>
                        {%endif%}
                    <div class="row">
                        <div class="col-6">
                            <div class="card mb-3">
                                <div class="card-header">{{ 'partners.info_client'|trans({},'label', 'fr') }}
                                </div>
                                <div class="form card-body">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_name" class="inline-label">{{ 'partners.name'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.name }}</span>
                                                {{ form_widget(form.name, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_address1" class="inline-label">{{ 'partners.address1'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.address1 }}</span>
                                                {{ form_widget(form.address1, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_address2" class="inline-label">{{ 'partners.address2'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.address2 }}</span>
                                                {{ form_widget(form.address2, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_zipCode" class="inline-label">{{ 'partners.zipcode'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.zipCode }}</span>
                                                {{ form_widget(form.zipCode, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_city" class="inline-label">{{ 'partners.city'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.city }}</span>
                                                {{ form_widget(form.city, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_country" class="inline-label">{{ 'partners.country'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.country }}</span>
                                                {{ form_widget(form.country, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_civility" class="inline-label" >{{ 'partners.civility'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.civility.longLabel }}</span>
                                                {{ form_widget(form.civility, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_lastname" class="inline-label">{{ 'partners.lastname'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.lastname }}</span>
                                                {{ form_widget(form.lastname, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_firstname" class="inline-label">{{ 'partners.firstname'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.firstname }}</span>
                                                {{ form_widget(form.firstname, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_mail" class="inline-label">{{ 'partners.mail'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.mail }}</span>
                                                {{ form_widget(form.mail, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_phone" class="inline-label">{{ 'partners.phone'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.phone }}</span>
                                                {{ form_widget(form.phone, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_mobile" class="inline-label">{{ 'partners.mobile'|trans({},'label', 'fr') }} :</label>
                                                {{ form_widget(form.mobile, { 'attr': {'class': 'form-control'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_category" class="inline-label">{{ 'partners.category'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.category }}</span>
                                                {{ form_widget(form.category, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card mb-2">
                                <div class="card-header">{{ 'partners.info_partner'|trans({},'label', 'fr') }}</div>
                                <div class="form card-body">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_partner" class="inline-label">{{ 'partners.parent'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.parent.name }}</span>
                                                {{ form_widget(form.parent, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-2">
                                <div class="card-header">{{ 'partners.neobe_pack'|trans({},'label', 'fr') }}
                                </div>
                                <div class="form card-body">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_nbLicense" class="inline-label">{{ 'partners.nb_licence'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.nbLicense }}</span>
                                                {{ form_widget(form.nbLicense, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_volumeSize" class="inline-label">{{ 'partners.volume_size'|trans({},'label', 'fr') }} : </label>
                                                <span> {{ partner.volumeSize }}</span>
                                                {{ form_widget(form.volumeSize, { 'attr': {'class': 'form-control hidden'} }) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-2">
                                <div class="card-header">{{ 'simulations.creation_date'|trans({},'label', 'fr') }}</div>
                                <div class="form card-body">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <div class="col-md-12">
                                                <label for="partner_partner" style="font-weight: 600;">{{ 'simulations.edit_creation_date'|trans({},'label', 'fr') }}</label>
                                                {{ form_widget(form.createdAt, { 'attr': {'class': 'form-control'} }) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-row">
                            <div class="col-md-2">
                                <input type="submit" class="btn btn-primary btn-block" value="Enregistrer">
                            </div>
                        </div>
                    </div>

                    {{ form_end(form) }}
                </div>

            </div>



                {# afficher le formulaire #}
                {% if (partner.neobeAccountId > 0) %}
                <div class="card mb-3">
                    <div class="card-header">{{ 'simulations.neobe_admin_acces'|trans({},'label', 'fr') }}</div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <div id="dataTable_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <table class="table table-bordered dataTable" id="dataTable" role="grid" aria-describedby="dataTable_info" style="width: 100%;" width="100%" cellspacing="0">
                                            <thead>
                                            <tr role="row">
                                                <th class="sorting_asc" tabindex="0" aria-controls="dataTable" style="width: 50px;" aria-sort="ascending" aria-label="Id">#</th>
                                                <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 125px;" aria-sort="ascending" aria-label="{{ 'partners.mail'|trans({},'label', 'fr') }}">{{ 'partners.mail'|trans({},'label', 'fr') }}</th>
                                                <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 120px;" aria-sort="ascending" aria-label="{{ 'partners.neobe_account_id'|trans({},'label', 'fr') }}">{{ 'partners.neobe_account_id'|trans({},'label', 'fr') }}</th>
                                                <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 175px;" aria-label="{{ 'partners.nb_licence'|trans({},'label', 'fr') }}">{{ 'partners.nb_licence'|trans({},'label', 'fr') }}</th>
                                                <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 175px;" aria-label="{{ 'partners.volume_size'|trans({},'label', 'fr') }}">{{ 'partners.volume_size'|trans({},'label', 'fr') }}</th>
                                                <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 175px;" aria-label="{{ 'simulations.created_at'|trans({},'label', 'fr') }}">{{ 'simulations.created_at'|trans({},'label', 'fr') }}</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                                <tr role="row" class="odd">
                                                    <td class="sorting_1 text-right">{{ partner.id }}</td>
                                                    <td>{{ partner.mail }}</td>
                                                    <td class="sorting_1 text-right">{{ partner.neobeAccountId }}</td>
                                                    <td class="sorting_1 text-right">{{ partner.nbLicense }}</td>
                                                    <td class="sorting_1 text-right">{{ partner.volumeSize }}</td>
                                                    <td>{{ partner.neobeCreatedAt|date('d/m/Y') }} à {{ partner.neobeCreatedAt|date('H:i:s') }}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <div class="card mb-3">
                        <div class="card-header">{{ 'simulations.neobe_account_list'|trans({},'label', 'fr') }}</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <table class="table table-bordered dataTable" id="dataTable" role="grid" aria-describedby="dataTable_info" style="width: 100%;" width="100%" cellspacing="0">
                                                <thead>
                                                <tr role="row">
                                                    <th class="sorting_asc" tabindex="0" aria-controls="dataTable" style="width: 50px;" aria-sort="ascending" aria-label="Id">#</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 125px;" aria-sort="ascending" aria-label="{{ 'simulations.login'|trans({},'label', 'fr') }}">{{ 'simulations.login'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 120px;" aria-sort="ascending" aria-label="{{ 'simulations.volume_used'|trans({},'label', 'fr') }}">{{ 'simulations.volume_used'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 120px;" aria-sort="ascending" aria-label="{{ 'simulations.volume_total'|trans({},'label', 'fr') }}">{{ 'simulations.volume_total'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 160px;" aria-sort="ascending" aria-label="{{ 'simulations.created_at'|trans({},'label', 'fr') }}">{{ 'simulations.created_at'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 100px;" aria-label="{{ 'simulations.installation'|trans({},'label', 'fr') }}">{{ 'simulations.installation'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 100px;" aria-label="{{ 'simulations.saved'|trans({},'label', 'fr') }}">{{ 'simulations.saved'|trans({},'label', 'fr') }}</th>
                                                    <th class="sorting" tabindex="0" aria-controls="dataTable" style="width: 160px;" aria-label="{{ 'simulations.last_save'|trans({},'label', 'fr') }}">{{ 'simulations.last_save'|trans({},'label', 'fr') }}</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% if(partner.accounts|length > 0) %}
                                                    {% for  n in partner.accounts %}
                                                        <tr role="row" class="odd">
                                                            <td class="sorting_1 text-right">{{ n.id }}</td>
                                                            <td>{{ n.login }}</td>
                                                            <td class="sorting_1 text-right">{{ n.usedSize }}</td>
                                                            <td class="sorting_1 text-right">{{ n.totalSize }}</td>
                                                            <td class="sorting_1 text-right">{{ n.neobeCreationDate|date('d/m/Y') }} à {{ n.neobeCreationDate|date('H:i:s') }}</td>
                                                            <td>{{ n.installed }}</td>
                                                            <td>{{ n.saved }}</td>
                                                            <td>{{ n.updatedAt|date('d/m/Y') }} à {{ n.updatedAt|date('H:i:s') }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    <tr role="row" class="odd ">
                                                        <td colspan="6" class="text-center ">{{ 'common.table.no_data'|trans({},'label', 'fr') }}</td>
                                                    </tr>
                                                {% endif %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <div class="card mb-3">
                        <div class="card-header">Confirmation création de compte client</div>
                        <div class="form card-body">
                            <div class="form-group">
                                <form action="{{ path('steps_two_simulation', {'token' : partner.hash, 'id': partner.id}) }}" method="post">
                                    <div class="form-group row">
                                        <p style="text-align: center">
                                            <input type="checkbox" name="create-account" id="create-account" checked style="margin-right: 15px; margin-left: 15px;" >
                                            <span>Créer des licences</span>
                                        </p>
                                    </div>
                                    <div class="form-group row create-account">
                                        <label for="" class="col-sm-4">Nombre de licences à créer:</label>
                                        <div class="col-sm-8">
                                            <input required="required" type="number" name="nb_licences_a_creer" class="form-control step" id="nb_licences_a_creer" placeholder="00">
                                        </div>
                                    </div>
                                    <div class="form-group row create-account">
                                        <label for="" class="col-sm-4">Volume par licence(Go):</label>
                                        <div class="col-sm-8">
                                            <input required="required" type="number" name="volume_par_licence_Go" class="form-control step" id="volume_par_licence_Go" placeholder="00 Go">
                                        </div>
                                    </div>
                                    <div class="col" style="text-align: center;">
                                        <button type="submit"  class="btn btn-primary btn-block" >Confirmer la création de compte Neobe</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endif %}

        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).on('click', '#create-account', function (e) {
            if($(this).prop('checked')) {
                $('.create-account').show();
                $('#nb_licences_a_creer').attr('required',true);
                $('#volume_par_licence_Go').attr('required',true);
            } else {
                $('.create-account').hide();
                $('#nb_licences_a_creer').attr('required',false);
                $('#volume_par_licence_Go').attr('required',false);
            }
        });
        $('.hidden').each(function( index ) {
            $( this ).hide();
        });
    </script>


{% endblock %}